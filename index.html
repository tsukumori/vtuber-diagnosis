<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 40px;
}
button {
  padding: 10px 16px;
  margin: 6px;
  font-size: 14px;
  min-width: 220px;
  cursor: pointer;
}
#question { font-size: 20px; margin-bottom: 20px; }
#result { font-size: 22px; font-weight: bold; margin-top: 20px; }
.switches {
  position: fixed;
  top: 10px;
  right: 10px;
  border: 1px solid #ccc;
  padding: 10px;
  background: #f9f9f9;
  font-size: 12px;
}
</style>
</head>
<body>

<h1>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>

<div class="switches">
  <label>
    <input type="checkbox" id="modeSwitch" checked>
    ã‚ªãƒ¼ãƒ‡ã‚£ã‚·ãƒ§ãƒ³å‰è¡¨ç¤ºï¼ˆç•ªå·è¡¨ç¤ºï¼‰
  </label><br>
  <label>
    <input type="checkbox" id="rainbowSwitch">
    ğŸŒˆ è™¹è‰²ãƒã‚¤ã‚¯ç¢ºå®š
  </label>
</div>

<div id="inputArea">
  <p>
    æ´»å‹•åï¼ˆå¿…é ˆï¼‰<br>
    <input id="nameInput">
  </p>

  <p>
    SNSï¼ˆä»»æ„ï¼‰<br>
    <input id="snsInput">
  </p>

  <button onclick="startDiagnosis()">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <br><br>

  <p><strong>è¨ºæ–­æ¸ˆã¿ï¼ˆç•ªå·å–å¾—æ¸ˆã¿ï¼‰ã®æ–¹ã¯ã“ã¡ã‚‰</strong></p>

  <p>
    è¨ºæ–­çµæœç•ªå·ï¼ˆ1ã€œ20ï¼‰<br>
    <input id="directNumber" type="number" min="1" max="20">
  </p>

  <button onclick="jumpResult()">ç•ªå·ã§çµæœã‚’è¦‹ã‚‹</button>
</div>

<div id="diagnosisArea" style="display:none;">
  <div id="question"></div>
  <div id="buttons"></div>
  <button onclick="goBack()">â† æˆ»ã‚‹</button>
</div>

<div id="resultArea" style="display:none;">
  <div id="result"></div>
  <div id="resultImage"></div>
  <button id="shareBtn">Xã§å…±æœ‰</button><br>
  <button onclick="restart()">ã‚‚ã†ä¸€åº¦è¨ºæ–­</button>
</div>

<script>
/* =====================
   å®šæ•°ãƒ»å¤‰æ•°
===================== */
const resultList = [
  null,
  "ã¿ã‚“ãªã‚’é€£ã‚Œã¦ã„ãå†’é™ºåœ°å›³",
  "æ­¢ã¾ã‚‰ãªã„ãŠã—ã‚ƒã¹ã‚Šãƒªãƒƒãƒ—",
  "ãƒãƒªã§æ’ƒã¤ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¬ãƒ³",
  "ä¸€ç¬ã§æ²¸ã‹ã™ãƒ‰æ´¾æ‰‹ã‚¯ãƒ©ãƒƒã‚«ãƒ¼",
  "å®‰å®šé‹ç”¨ã®ç ‚æ™‚è¨ˆ",
  "è©±é¡Œç„¡é™ã®åœ°çƒå„€",
  "å®Œç’§ä¸»ç¾©ã®ãƒã‚§ãƒƒã‚¯è…•æ™‚è¨ˆ",
  "æ€ã„å‡ºã‚’æŒŸã‚€æŠ¼ã—èŠ±ã®æ ",
  "èŠ¯ã®ã‚ã‚‹ä¸‡å¹´ç­†",
  "å¤¢è¦‹ãŒã¡ãªã‚­ãƒ©ã‚­ãƒ©ä¸‡è¯é¡",
  "æ­£ç›´ä¸€ç›´ç·šã®ç‹é“ã‚½ãƒ¼ãƒ‰",
  "ã‹ã¾ã£ã¦ã»ã—ã„ã†ã•è€³",
  "ä¸–ç•Œã‚’çµ„ã¿ç«‹ã¦ã‚‹å°æœ¬ãƒãƒ¼ãƒˆ",
  "å¤œã«ã²ã‚‰ãæ—¥è¨˜å¸³",
  "å†·é™æ²ˆç€ã®çœŸé¢ç›®ã•ã‚“çŸ¥æ€§ãƒ¡ã‚¬ãƒ",
  "ã“ã¨ã°ãŒé€ã‘ã‚‹ç¹Šç´°ã‚¬ãƒ©ã‚¹ãƒšãƒ³",
  "æµã‚Œã«åˆã‚ã›ã‚‹èª¿å¾‹ã®å¤©ç§¤",
  "ğŸŒˆ è™¹è‰²ãƒã‚¤ã‚¯",
  "ãµã‚ãµã‚å¤©ä½¿ã®ç¾½",
  "æ²¼ã‚‰ã›å°æ‚ªé­”ã®é»’ç¾½"
];

const resultKeyMap = {
  "0000":1,"0001":2,"0010":3,"0011":4,
  "0100":5,"0101":6,"0110":7,"0111":8,
  "1000":9,"1001":10,"1010":11,"1011":12,
  "1100":13,"1101":14,"1110":15,"1111":16
};

let userName = "";
let userSNS = "";
let scores = {A:0,B:0,C:0,D:0};
let current = 0;
let history = [];
let angelDevilChoice = null;

const questions = [
 { axis: "A", text: "é…ä¿¡ã®ç†æƒ³ã¯ï¼Ÿ", choices: ["ä¸€äººã§é»™ã€…ã‚„ã‚‹", "ã©ã¡ã‚‰ã§ã‚‚", "èª°ã‹ã¨ä¸€ç·’ã«ã‚„ã‚‹"] },
 { axis: "A", text: "ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ããŸã¨ãã€ã©ã†ã™ã‚‹ï¼Ÿ", choices: ["ã¾ãšä¸€äººã§è€ƒãˆã‚‹", "å ´åˆã«ã‚ˆã‚‹", "ã™ãèª°ã‹ã«ç›¸è«‡"] },
 { axis: "A", text: "ã‚³ãƒ©ãƒœé…ä¿¡ã«ã¤ã„ã¦ã©ã†æ€ã†ï¼Ÿ", choices: ["æ­£ç›´ã‚ã¾ã‚Šå¾—æ„ã˜ã‚ƒãªã„", "ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„", "å¤§å¥½ãï¼ç©æ¥µçš„"] },

 { axis: "B", text: "é…ä¿¡å†…å®¹ã‚’æ±ºã‚ã‚‹ã¨ãã¯ï¼Ÿ", choices: ["æ•°å­—ã‚„åå¿œã‚’é‡è¦–", "åŠã€…ãã‚‰ã„", "æ°—åˆ†ã‚„ãƒãƒª"] },
 { axis: "B", text: "é…ä¿¡å¾Œã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ï¼Ÿ", choices: ["ã‹ãªã‚Šç´°ã‹ãè¦‹ã‚‹", "ãŸã¾ã«è¦‹ã‚‹", "ã»ã¨ã‚“ã©è¦‹ãªã„"] },
 { axis: "B", text: "ä¼¸ã³ã‚‹é…ä¿¡ã«å¿…è¦ã ã¨æ€ã†ã®ã¯ï¼Ÿ", choices: ["åˆ†æã¨æ”¹å–„", "ä¸¡æ–¹å¤§äº‹", "å‹¢ã„ã¨ç†±é‡"] },

 { axis: "C", text: "ç†æƒ³ã®é…ä¿¡æ™‚é–“ã¯ï¼Ÿ", choices: ["1æ™‚é–“å‰å¾Œ", "2ã€œ3æ™‚é–“", "æ°—ã¥ã„ãŸã‚‰é•·æ™‚é–“"] }, 
 { axis: "C", text: "é…ä¿¡ä¸­ã®é›†ä¸­åŠ›ã¯ï¼Ÿ", choices: ["çŸ­æœŸé›†ä¸­å‹", "æ³¢ãŒã‚ã‚‹", "é•·ãç¶šã"] }, 
 { axis: "C", text: "ã‚²ãƒ¼ãƒ ã‚„ä½œæ¥­ã«ãƒãƒã‚‹ã¨ï¼Ÿ", choices: ["ã™ãé£½ãã‚‹", "ã‚‚ã®ã«ã‚ˆã‚‹", "ä½•æ™‚é–“ã‚‚ã‚„ã‚‹"] },

 { axis: "D", text: "é…ä¿¡æº–å‚™ã¯ã©ã‚Œãã‚‰ã„ã™ã‚‹ï¼Ÿ", choices: ["ã»ã¼ãƒãƒ¼ãƒ—ãƒ©ãƒ³", "æœ€ä½é™", "ã—ã£ã‹ã‚Š"] }, 
 { axis: "D", text: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã¯ï¼Ÿ", choices: ["ã‚†ã‚‹ã‚", "æ™®é€š", "ãã£ã¡ã‚Š"] }, 
 { axis: "D", text: "å°æœ¬ã‚„é€²è¡Œè¡¨ã«ã¤ã„ã¦", choices: ["ã‚ã¾ã‚Šä½¿ã‚ãªã„", "ã‚ã‚‹ã¨å®‰å¿ƒ", "å¿…é ˆ"] },

 { axis: null, text: "è‡ªåˆ†ã®é›°å›²æ°—ã«åˆã£ã¦ã„ã‚‹ã¨æ€ã†è¨€è‘‰ã¯ï¼Ÿ",
   choices: ["ã€Œç™’ã•ã‚Œã‚‹ã€ã€Œå®ˆã‚ŠãŸã„ã€","ã©ã¡ã‚‰ã‚‚ã—ã£ãã‚Šã“ãªã„ï¼ã©ã¡ã‚‰ã‚‚åˆã£ã¦ã„ã‚‹","ã€Œãšã‚‹ã„ã€ã€Œæ²¼ã‚‹ã€"] }
];

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

function startDiagnosis(){
  userName = document.getElementById("nameInput").value.trim();
  userSNS  = document.getElementById("snsInput").value.trim();
  if(!userName){ alert("æ´»å‹•åã‚’å…¥åŠ›ã—ã¦ã­"); return; }
  shuffle(questions);
  document.getElementById("inputArea").style.display="none";
  document.getElementById("diagnosisArea").style.display="block";
  showQuestion();
}

function showQuestion(){
  const q = questions[current];
  document.getElementById("question").textContent = `Q${current+1}. ${q.text}`;
  const buttons = document.getElementById("buttons");
  buttons.innerHTML="";
  q.choices.forEach((c,i)=>{
    const b=document.createElement("button");
    b.textContent=c;
    b.onclick=()=>answer(i-1);
    buttons.appendChild(b);
  });
}

function answer(v){
  const a=questions[current].axis;
  history.push({a,v});
  if(a){
    scores[a]+=v;
  }else{
    angelDevilChoice = v;
  }
  current++;
  current<questions.length ? showQuestion() : showResult(calcResult());
}

function goBack(){
  if(current===0)return;
  current--;
  const h=history.pop();
  if(h.a){
    scores[h.a]-=h.v;
  }else{
    angelDevilChoice = null;
  }
  showQuestion();
}

function calcResult(){
  if(document.getElementById("rainbowSwitch").checked) return 18;

  let key="", balanced=0;
  ["A","B","C","D"].forEach(a=>{
    if(Math.abs(scores[a])<=1) balanced++;
    key+=scores[a]>=0?"0":"1";
  });

  let base;
  if(balanced>=3) base=17;
  else if(Math.random()<0.00001) base=18;
  else base=resultKeyMap[key];

  const isFuwa = scores.D < 0;
  const isShikkari = scores.D > 0;
  const isPassion = scores.B > 0;
  const isData = scores.B < 0;

  if(angelDevilChoice === -1){
    if(isFuwa && isPassion && Math.random()<0.3) return 19;
  }

  if(angelDevilChoice === 1){
    if(isShikkari && isData && Math.random()<0.3) return 20;
  }

  return base;
}

function showResult(num){
  document.getElementById("diagnosisArea").style.display="none";
  document.getElementById("resultArea").style.display="block";

  const after = !document.getElementById("modeSwitch").checked;
  const isRainbow = (num === 18);
  const display = after ? resultList[num] : `è¨ºæ–­çµæœç•ªå·ï¼š${num}`;

  document.getElementById("result").textContent =
    `${userName}ã•ã‚“ã®è¨ºæ–­çµæœï¼š${display}`;

  document.getElementById("resultImage").innerHTML =
    after
      ? `<img src="${num}.png" alt="è¨ºæ–­çµæœç”»åƒ" style="max-width:300px;margin-top:20px;">`
      : "";

  const shareBtn = document.getElementById("shareBtn");

  if(after){
    shareBtn.style.display="inline-block";

    const tweetText = isRainbow
      ? `ã€ğŸŒˆè¶…ãƒ¬ã‚¢è¨ºæ–­çµæœğŸŒˆã€‘
${userName}ã•ã‚“ã®é…ä¿¡ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€é©ãªã‚¢ã‚¤ãƒ†ãƒ ã¯
ã€Œè™¹è‰²ãƒã‚¤ã‚¯ï¼ˆé¸ã°ã‚Œã—è€…ï¼‰ã€ã§ã—ãŸğŸ¤âœ¨

#VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­ #NyanProLab`
      : `${userName}ã•ã‚“ã®é…ä¿¡ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€é©ãªã‚¢ã‚¤ãƒ†ãƒ ã¯ã€Œ${resultList[num]}ã€ã§ã—ãŸğŸ©µâœ¨
ã‚ãªãŸã¯ä½•ãŒå‡ºã‚‹ï¼Ÿ

#VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­ #NyanProLab`;

    shareBtn.onclick = ()=>{
      window.open(
        "https://twitter.com/intent/tweet?text=" +
        encodeURIComponent(tweetText),
        "_blank"
      );
    };
  }else{
    shareBtn.style.display="none";
  }

  sendToGoogleForm(num);
}

function jumpResult(){
  userName = document.getElementById("nameInput").value.trim();
  userSNS  = document.getElementById("snsInput").value.trim();
  const n=parseInt(document.getElementById("directNumber").value);
  if(!userName){ alert("æ´»å‹•åã‚’å…¥åŠ›ã—ã¦ã­"); return; }
  if(n<1||n>20){ alert("1ã€œ20ã§å…¥åŠ›ã—ã¦ã­"); return; }
  document.getElementById("inputArea").style.display="none";
  showResult(n);
}

function restart(){
  scores={A:0,B:0,C:0,D:0};
  angelDevilChoice=null;
  current=0; history=[];
  document.getElementById("resultArea").style.display="none";
  document.getElementById("inputArea").style.display="block";
}

function sendToGoogleForm(num){
  const url="https://docs.google.com/forms/d/e/1FAIpQLSeImoVfM8wsLUi4aGz1tcqxeHvzNd9EGf3Lp926IHsy03L3VQ/formResponse";
  const d=new FormData();
  d.append("entry.2016327248",userName);
  d.append("entry.363261105",userSNS);
  d.append("entry.429828253",num);
  d.append("entry.1683531211", scores.A);
  d.append("entry.1818111503", scores.B);
  d.append("entry.772384761", scores.C);
  d.append("entry.1265151043", scores.D);
  fetch(url,{method:"POST",mode:"no-cors",body:d});
}
</script>

</body>
</html>
