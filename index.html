<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
<style>
body {
  font-family: sans-serif;
  text-align: center;
  padding: 40px;
}
button {
  padding: 10px 16px;
  margin: 6px;
  font-size: 14px;
  min-width: 220px;
  cursor: pointer;
}
#question { font-size: 20px; margin-bottom: 20px; }
#result { font-size: 22px; font-weight: bold; margin-top: 20px; }
.switches {
  position: fixed;
  top: 10px;
  right: 10px;
  border: 1px solid #ccc;
  padding: 10px;
  background: #f9f9f9;
  font-size: 12px;
}
</style>
</head>
<body>

<h1>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>

<!-- ãƒ†ã‚¹ãƒˆç”¨ã‚¹ã‚¤ãƒƒãƒï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ -->
<div class="switches">
  <label>
    <input type="checkbox" id="modeSwitch">
    ã‚ªãƒ¼ãƒ‡ã‚£ã‚·ãƒ§ãƒ³å¾Œè¡¨ç¤ºï¼ˆã‚¢ã‚¤ãƒ†ãƒ åï¼‰
  </label><br>
  <label>
    <input type="checkbox" id="rainbowSwitch">
    ğŸŒˆ è™¹è‰²ãƒã‚¤ã‚¯ç¢ºå®š
  </label>
</div>

<!-- å…¥åŠ›ç”»é¢ -->
<div id="inputArea">
  <p>
    æ´»å‹•åï¼ˆå¿…é ˆï¼‰<br>
    <input id="nameInput">
  </p>

  <p>
    SNSï¼ˆä»»æ„ï¼‰<br>
    <input id="snsInput">
  </p>

  <button onclick="startDiagnosis()">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

  <br><br>

  <p><strong>è¨ºæ–­æ¸ˆã¿ï¼ˆç•ªå·å–å¾—æ¸ˆã¿ï¼‰ã®æ–¹ã¯ã“ã¡ã‚‰</strong></p>

  <p>
    è¨ºæ–­çµæœç•ªå·ï¼ˆ1ã€œ18ï¼‰<br>
    <input id="directNumber" type="number" min="1" max="18">
  </p>

  <button onclick="jumpResult()">ç•ªå·ã§çµæœã‚’è¦‹ã‚‹</button>
</div>

<!-- è¨ºæ–­ç”»é¢ -->
<div id="diagnosisArea" style="display:none;">
  <div id="question"></div>
  <div id="buttons"></div>
  <button onclick="goBack()">â† æˆ»ã‚‹</button>
</div>

<!-- çµæœç”»é¢ -->
<div id="resultArea" style="display:none;">
  <div id="result"></div>
  <button id="shareBtn">Xã§å…±æœ‰</button><br>
  <button onclick="restart()">ã‚‚ã†ä¸€åº¦è¨ºæ–­</button>
</div>

<script>
/* =====================
   å®šæ•°ãƒ»å¤‰æ•°
===================== */
const resultList = [
  null,
  "æŠ¼ã—èŠ±ã®æ ","ä¸‡å¹´ç­†","é‡£ã‚Š","ç ‚æ™‚è¨ˆ",
  "ã‚¬ãƒ©ã‚¹ãƒšãƒ³","å‰£","ä¸‡è¯é¡","æ–‡å­—ãŒæµã‚Œã‚‹å°æœ¬ãƒãƒ¼ãƒˆ",
  "åœ°çƒå„€","ç„¡é™ãƒ„ãƒƒã‚³ãƒŸãƒãƒªã‚»ãƒ³","çŸ¥æ€§ãƒ¡ã‚¬ãƒ","ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè…•æ™‚è¨ˆ",
  "ã·ã‚Šã·ã‚ŠçŒ«è€³","ãƒ‰æ´¾æ‰‹ã‚¯ãƒ©ãƒƒã‚«ãƒ¼","ãµã‚ãµã‚å¤©ä½¿ã®ç¾½","å†’é™ºåœ°å›³",
  "âš–ï¸ å¤©ç§¤","ğŸŒˆ è™¹è‰²ãƒã‚¤ã‚¯ï¼ˆé¸ã°ã‚Œã—è€…ï¼‰"
];

const resultKeyMap = {
  "0000":1,"0001":2,"0010":3,"0011":4,
  "0100":5,"0101":6,"0110":7,"0111":8,
  "1000":9,"1001":10,"1010":11,"1011":12,
  "1100":13,"1101":14,"1110":15,"1111":16
};

let userName = "";
let userSNS = "";
let scores = {A:0,B:0,C:0,D:0};
let current = 0;
let history = [];

const questions = [
  {axis:"A",text:"é…ä¿¡ã®ç†æƒ³ã¯ï¼Ÿ",choices:["ä¸€äºº","ã©ã¡ã‚‰ã§ã‚‚","èª°ã‹ã¨"]},
  {axis:"A",text:"ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã¯ï¼Ÿ",choices:["ä¸€äººã§","å ´åˆã«ã‚ˆã‚‹","ç›¸è«‡"]},
  {axis:"A",text:"ã‚³ãƒ©ãƒœã¯ï¼Ÿ",choices:["è‹¦æ‰‹","æ™®é€š","å¥½ã"]},

  {axis:"B",text:"é…ä¿¡å†…å®¹ã¯ï¼Ÿ",choices:["åˆ†æ","åŠã€…","ãƒãƒª"]},
  {axis:"B",text:"ãƒ‡ãƒ¼ã‚¿è¦‹ã‚‹ï¼Ÿ",choices:["è¦‹ã‚‹","ãŸã¾ã«","è¦‹ãªã„"]},
  {axis:"B",text:"ä¼¸ã³ã‚‹ç§˜è¨£ã¯ï¼Ÿ",choices:["æ”¹å–„","ä¸¡æ–¹","å‹¢ã„"]},

  {axis:"C",text:"é…ä¿¡æ™‚é–“ã¯ï¼Ÿ",choices:["çŸ­ã‚","æ™®é€š","é•·æ™‚é–“"]},
  {axis:"C",text:"é›†ä¸­åŠ›ã¯ï¼Ÿ",choices:["çŸ­æœŸ","æ³¢","æŒç¶š"]},
  {axis:"C",text:"ãƒãƒã‚‹ã¨ï¼Ÿ",choices:["é£½ãã‚‹","æ™®é€š","æ²¡é ­"]},

  {axis:"D",text:"æº–å‚™é‡ã¯ï¼Ÿ",choices:["ãªã—","æœ€ä½é™","ä¸‡å…¨"]},
  {axis:"D",text:"ç®¡ç†ã¯ï¼Ÿ",choices:["ã‚†ã‚‹ã„","æ™®é€š","å³å¯†"]},
  {axis:"D",text:"å°æœ¬ã¯ï¼Ÿ",choices:["ä½¿ã‚ãªã„","å®‰å¿ƒ","å¿…é ˆ"]}
];

/* =====================
   å…±é€š
===================== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
}

/* =====================
   è¨ºæ–­é–‹å§‹
===================== */
function startDiagnosis(){
  userName = document.getElementById("nameInput").value.trim();
  userSNS  = document.getElementById("snsInput").value.trim();

  if(!userName){
    alert("æ´»å‹•åã‚’å…¥åŠ›ã—ã¦ã­");
    return;
  }

  shuffle(questions);
  document.getElementById("inputArea").style.display="none";
  document.getElementById("diagnosisArea").style.display="block";
  showQuestion();
}

function showQuestion(){
  const q = questions[current];
  document.getElementById("question").textContent = `Q${current+1}. ${q.text}`;
  const buttons = document.getElementById("buttons");
  buttons.innerHTML = "";

  q.choices.forEach((c,i)=>{
    const b=document.createElement("button");
    b.textContent=c;
    b.onclick=()=>answer(i-1);
    buttons.appendChild(b);
  });
}

function answer(v){
  const a=questions[current].axis;
  history.push({a,v});
  scores[a]+=v;
  current++;
  current<questions.length ? showQuestion() : showResult(calcResult());
}

function goBack(){
  if(current===0)return;
  current--;
  const h=history.pop();
  scores[h.a]-=h.v;
  showQuestion();
}

/* =====================
   çµæœè¨ˆç®—
===================== */
function calcResult(){
  if(document.getElementById("rainbowSwitch").checked) return 18;

  let key="", balanced=0;
  ["A","B","C","D"].forEach(a=>{
    if(Math.abs(scores[a])<=1) balanced++;
    key+=scores[a]>=0?"0":"1";
  });

  if(balanced>=3) return 17;
  if(Math.random()<0.00001) return 18;
  return resultKeyMap[key];
}

function showResult(num){
  document.getElementById("diagnosisArea").style.display="none";
  document.getElementById("resultArea").style.display="block";

  const after = document.getElementById("modeSwitch").checked;
  const display = after ? resultList[num] : `è¨ºæ–­çµæœç•ªå·ï¼š${num}`;

  document.getElementById("result").textContent =
    `${userName}ã•ã‚“ã®è¨ºæ–­çµæœï¼š${display}`;

  document.getElementById("shareBtn").onclick = ()=>{
    window.open(
      "https://twitter.com/intent/tweet?text=" +
      encodeURIComponent(`${userName}ã®è¨ºæ–­çµæœã¯ã€Œ${resultList[num]}ã€ï¼ #VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­ #NyanProLab`)
    );
  };

  sendToGoogleForm(num);
}

/* =====================
   ç•ªå·ã‚¸ãƒ£ãƒ³ãƒ—
===================== */
function jumpResult(){
  userName = document.getElementById("nameInput").value.trim();
  userSNS  = document.getElementById("snsInput").value.trim();
  const n = parseInt(document.getElementById("directNumber").value);

  if(!userName){
    alert("æ´»å‹•åã‚’å…¥åŠ›ã—ã¦ã­");
    return;
  }
  if(n<1 || n>18){
    alert("1ã€œ18ã§å…¥åŠ›ã—ã¦ã­");
    return;
  }

  document.getElementById("inputArea").style.display="none";
  showResult(n);
}

function restart(){
  scores={A:0,B:0,C:0,D:0};
  current=0; history=[];
  document.getElementById("resultArea").style.display="none";
  document.getElementById("inputArea").style.display="block";
}

/* =====================
   Googleãƒ•ã‚©ãƒ¼ãƒ 
===================== */
function sendToGoogleForm(num){
  const url="https://docs.google.com/forms/d/e/1FAIpQLSeImoVfM8wsLUi4aGz1tcqxeHvzNd9EGf3Lp926IHsy03L3VQ/formResponse";
  const d=new FormData();
  d.append("entry.2016327248",userName);
  d.append("entry.363261105",userSNS);
  d.append("entry.429828253",num);
  fetch(url,{method:"POST",mode:"no-cors",body:d});
}
</script>

</body>
</html>
