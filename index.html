<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    button {
      padding: 12px 18px;
      margin: 6px;
      font-size: 14px;
      cursor: pointer;
      min-width: 200px;
    }
    #question {
      font-size: 20px;
      margin-bottom: 20px;
    }
    #result {
      margin-top: 30px;
      font-size: 22px;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h1>VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­</h1>

<div id="inputArea">
  <p>
    æ´»å‹•åï¼ˆå¿…é ˆï¼‰<br>
    <input type="text" id="name">
  </p>
  <p>
    SNSï¼ˆä»»æ„ï¼‰<br>
    <input type="text" id="sns">
  </p>
  <button onclick="startDiagnosis()">è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<div id="diagnosisArea" style="display:none;">
  <div id="question"></div>
  <div id="buttons"></div>
</div>

<div id="resultArea" style="display:none;">
  <div id="result"></div>
  <button id="shareBtn">Xã§å…±æœ‰ã™ã‚‹</button>
</div>

<script>
let userName = "";
let userSNS = "";

let scores = { A: 0, B: 0, C: 0, D: 0 };
let current = 0;

let questions = [
  { axis: "A", text: "é…ä¿¡ã®ç†æƒ³ã¯ï¼Ÿ", choices: ["ä¸€äººã§é»™ã€…ã‚„ã‚‹", "ã©ã¡ã‚‰ã§ã‚‚", "èª°ã‹ã¨ä¸€ç·’ã«ã‚„ã‚‹"] },
  { axis: "A", text: "ãƒˆãƒ©ãƒ–ãƒ«ãŒèµ·ããŸã¨ãã€ã©ã†ã™ã‚‹ï¼Ÿ", choices: ["ã¾ãšä¸€äººã§è€ƒãˆã‚‹", "å ´åˆã«ã‚ˆã‚‹", "ã™ãèª°ã‹ã«ç›¸è«‡"] },
  { axis: "A", text: "ã‚³ãƒ©ãƒœé…ä¿¡ã«ã¤ã„ã¦ã©ã†æ€ã†ï¼Ÿ", choices: ["æ­£ç›´ã‚ã¾ã‚Šå¾—æ„ã˜ã‚ƒãªã„", "ã©ã¡ã‚‰ã¨ã‚‚è¨€ãˆãªã„", "å¤§å¥½ãï¼ç©æ¥µçš„"] },

  { axis: "B", text: "é…ä¿¡å†…å®¹ã‚’æ±ºã‚ã‚‹ã¨ãã¯ï¼Ÿ", choices: ["æ•°å­—ã‚„åå¿œã‚’é‡è¦–", "åŠã€…ãã‚‰ã„", "æ°—åˆ†ã‚„ãƒãƒª"] },
  { axis: "B", text: "é…ä¿¡å¾Œã€ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ï¼Ÿ", choices: ["ã‹ãªã‚Šç´°ã‹ãè¦‹ã‚‹", "ãŸã¾ã«è¦‹ã‚‹", "ã»ã¨ã‚“ã©è¦‹ãªã„"] },
  { axis: "B", text: "ä¼¸ã³ã‚‹é…ä¿¡ã«å¿…è¦ã ã¨æ€ã†ã®ã¯ï¼Ÿ", choices: ["åˆ†æã¨æ”¹å–„", "ä¸¡æ–¹å¤§äº‹", "å‹¢ã„ã¨ç†±é‡"] },

  { axis: "C", text: "ç†æƒ³ã®é…ä¿¡æ™‚é–“ã¯ï¼Ÿ", choices: ["1æ™‚é–“å‰å¾Œ", "2ã€œ3æ™‚é–“", "æ°—ã¥ã„ãŸã‚‰é•·æ™‚é–“"] },
  { axis: "C", text: "é…ä¿¡ä¸­ã®é›†ä¸­åŠ›ã¯ï¼Ÿ", choices: ["çŸ­æœŸé›†ä¸­å‹", "æ³¢ãŒã‚ã‚‹", "é•·ãç¶šã"] },
  { axis: "C", text: "ã‚²ãƒ¼ãƒ ã‚„ä½œæ¥­ã«ãƒãƒã‚‹ã¨ï¼Ÿ", choices: ["ã™ãé£½ãã‚‹", "ã‚‚ã®ã«ã‚ˆã‚‹", "ä½•æ™‚é–“ã‚‚ã‚„ã‚‹"] },

  { axis: "D", text: "é…ä¿¡æº–å‚™ã¯ã©ã‚Œãã‚‰ã„ã™ã‚‹ï¼Ÿ", choices: ["ã»ã¼ãƒãƒ¼ãƒ—ãƒ©ãƒ³", "æœ€ä½é™", "ã—ã£ã‹ã‚Š"] },
  { axis: "D", text: "ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã¯ï¼Ÿ", choices: ["ã‚†ã‚‹ã‚", "æ™®é€š", "ãã£ã¡ã‚Š"] },
  { axis: "D", text: "å°æœ¬ã‚„é€²è¡Œè¡¨ã«ã¤ã„ã¦", choices: ["ã‚ã¾ã‚Šä½¿ã‚ãªã„", "ã‚ã‚‹ã¨å®‰å¿ƒ", "å¿…é ˆ"] }
];

const results = {
  "0000": "æŠ¼ã—èŠ±ã®æ ",
  "0001": "ä¸‡å¹´ç­†",
  "0010": "é‡£ã‚Š",
  "0011": "ç ‚æ™‚è¨ˆ",
  "0100": "ã‚¬ãƒ©ã‚¹ãƒšãƒ³",
  "0101": "å‰£",
  "0110": "ä¸‡è¯é¡",
  "0111": "æ–‡å­—ãŒæµã‚Œã‚‹å°æœ¬ãƒãƒ¼ãƒˆ",
  "1000": "åœ°çƒå„€",
  "1001": "ç„¡é™ãƒ„ãƒƒã‚³ãƒŸãƒãƒªã‚»ãƒ³",
  "1010": "çŸ¥æ€§ãƒ¡ã‚¬ãƒ",
  "1011": "ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆè…•æ™‚è¨ˆ",
  "1100": "ã·ã‚Šã·ã‚ŠçŒ«è€³",
  "1101": "ãƒ‰æ´¾æ‰‹ã‚¯ãƒ©ãƒƒã‚«ãƒ¼",
  "1110": "ãµã‚ãµã‚å¤©ä½¿ã®ç¾½",
  "1111": "å†’é™ºåœ°å›³"
};

// ã‚·ãƒ£ãƒƒãƒ•ãƒ«
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function startDiagnosis() {
  userName = document.getElementById("name").value;
  userSNS = document.getElementById("sns").value;

  if (!userName) {
    alert("æ´»å‹•åã‚’å…¥åŠ›ã—ã¦ã­ï¼");
    return;
  }

  shuffle(questions);

  document.getElementById("inputArea").style.display = "none";
  document.getElementById("diagnosisArea").style.display = "block";

  showQuestion();
}

function showQuestion() {
  const q = questions[current];
  document.getElementById("question").textContent =
    `Q${current + 1}. ${q.text}`;

  const buttons = document.getElementById("buttons");
  buttons.innerHTML = "";

  q.choices.forEach((label, index) => {
    const btn = document.createElement("button");
    btn.textContent = label;
    btn.onclick = () => answer(index - 1);
    buttons.appendChild(btn);
  });
}

function answer(value) {
  scores[questions[current].axis] += value;
  current++;

  if (current < questions.length) {
    showQuestion();
  } else {
    showResult();
  }
}

function showResult() {
  document.getElementById("diagnosisArea").style.display = "none";
  document.getElementById("resultArea").style.display = "block";

  let key = "";
  let balanced = 0;

  ["A","B","C","D"].forEach(axis => {
    if (Math.abs(scores[axis]) <= 1) balanced++;
    key += scores[axis] >= 0 ? "0" : "1";
  });

  let result =
    balanced >= 3
      ? "âš–ï¸ å¤©ç§¤ï¼ˆãƒãƒ©ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—ï¼‰"
      : results[key];

  // ğŸŒˆ è¶…ãƒ¬ã‚¢æŠ½é¸ï¼ˆ0.001%ï¼‰
  let isRainbow = false;
  if (Math.random() < 0.00001) {
    result = "ğŸŒˆ è™¹è‰²ãƒã‚¤ã‚¯ï¼ˆé¸ã°ã‚Œã—è€…ï¼‰";
    isRainbow = true;
    alert("ğŸ‰âœ¨ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ï¼âœ¨ğŸ‰\né¸ã°ã‚Œã—è€…ã ã‘ãŒæ‰‹ã«ã™ã‚‹ã€Šè™¹è‰²ãƒã‚¤ã‚¯ã€‹ãŒå‡ºã¾ã—ãŸï¼");
  }

  document.getElementById("result").textContent =
    `${userName}ã•ã‚“ã®é…ä¿¡ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€é©ãªã‚¢ã‚¤ãƒ†ãƒ ã¯ã€Œ${result}ã€ã§ã—ãŸï¼`;

  const tweetText = isRainbow
    ? `ã€ğŸŒˆè¶…ãƒ¬ã‚¢è¨ºæ–­çµæœğŸŒˆã€‘
${userName}ã®é…ä¿¡ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€é©ãªã‚¢ã‚¤ãƒ†ãƒ ã¯
ã€Œè™¹è‰²ãƒã‚¤ã‚¯ï¼ˆé¸ã°ã‚Œã—è€…ï¼‰ã€ã§ã—ãŸğŸ¤âœ¨

#VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­ #NyanProLab`
    : `${userName}ã®é…ä¿¡ã‚¹ã‚¿ã‚¤ãƒ«ã«æœ€é©ãªã‚¢ã‚¤ãƒ†ãƒ ã¯ã€Œ${result}ã€ã§ã—ãŸğŸ©µâœ¨
ã‚ãªãŸã¯ä½•ãŒå‡ºã‚‹ï¼Ÿ

#VTuberã‚¿ã‚¤ãƒ—è¨ºæ–­ #NyanProLab`;

  document.getElementById("shareBtn").onclick = () => {
    window.open(
      "https://twitter.com/intent/tweet?text=" +
      encodeURIComponent(tweetText),
      "_blank"
    );
  };

  sendToGoogleForm(result);
}

/* Googleãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ */
function sendToGoogleForm(result) {
  const formURL =
    "https://docs.google.com/forms/d/e/1FAIpQLSeImoVfM8wsLUi4aGz1tcqxeHvzNd9EGf3Lp926IHsy03L3VQ/formResponse";

  const data = new FormData();
  data.append("entry.2016327248", userName);
  data.append("entry.363261105", userSNS);
  data.append("entry.429828253", result);
  data.append("entry.1683531211", scores.A);
  data.append("entry.1818111503", scores.B);
  data.append("entry.772384761", scores.C);
  data.append("entry.1265151043", scores.D);

  fetch(formURL, {
    method: "POST",
    mode: "no-cors",
    body: data
  });
}
</script>

</body>
</html>
